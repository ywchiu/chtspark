{"paragraphs":[{"text":"%md \n\n## Spark Basic","dateUpdated":"Sep 7, 2018 2:55:21 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536288888439_-174745267","id":"20180907-025448_724246104","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>Spark Basic</h2>\n"},"dateCreated":"Sep 7, 2018 2:54:48 AM","dateStarted":"Sep 7, 2018 2:55:21 AM","dateFinished":"Sep 7, 2018 2:55:21 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4883"},{"text":"%sh \n\nexport http_proxy=http://10.160.3.88:8080\nexport https_proxy=http://10.160.3.88:8080\n\nwget https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/1800.csv\n","dateUpdated":"Sep 7, 2018 2:53:54 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536288667439_-859904793","id":"20180907-025107_2053227636","result":{"code":"SUCCESS","type":"TEXT","msg":"--2018-09-07 02:53:54--  https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/1800.csv\nConnecting to 10.160.3.88:8080... connected.\nProxy request sent, awaiting response... 200 OK\nLength: 62728 (61K) [text/plain]\nSaving to: “1800.csv”\n\n     0K .......... .......... .......... .......... .......... 81%  830K 0s\n    50K .......... .                                          100% 21473G=0.06s\n\n2018-09-07 02:53:55 (1017 KB/s) - “1800.csv” saved [62728/62728]\n\n"},"dateCreated":"Sep 7, 2018 2:51:07 AM","dateStarted":"Sep 7, 2018 2:53:54 AM","dateFinished":"Sep 7, 2018 2:53:55 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4884"},{"text":"%sh \nmv 1800.csv /tmp/\n\nhead /tmp/1800.csv","dateUpdated":"Sep 7, 2018 2:54:14 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536288751162_1568953717","id":"20180907-025231_1072032037","result":{"code":"SUCCESS","type":"TEXT","msg":"ITE00100554,18000101,TMAX,-75,,,E,\nITE00100554,18000101,TMIN,-148,,,E,\nGM000010962,18000101,PRCP,0,,,E,\nEZE00100082,18000101,TMAX,-86,,,E,\nEZE00100082,18000101,TMIN,-135,,,E,\nITE00100554,18000102,TMAX,-60,,I,E,\nITE00100554,18000102,TMIN,-125,,,E,\nGM000010962,18000102,PRCP,0,,,E,\nEZE00100082,18000102,TMAX,-44,,,E,\nEZE00100082,18000102,TMIN,-130,,,E,\n"},"dateCreated":"Sep 7, 2018 2:52:31 AM","dateStarted":"Sep 7, 2018 2:54:14 AM","dateFinished":"Sep 7, 2018 2:54:14 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4885"},{"text":"%pyspark\n\ndef parseLine(line):\n    fields = line.split(',')\n    stationID = fields[0]\n    entryType = fields[2]\n    temperature = float(fields[3]) * 0.1 * (9.0 / 5.0) + 32.0\n    return (stationID, entryType, temperature)\n    \n    \nlines = sc.textFile(\"file:///tmp/1800.csv\")\nprint(lines.take(3))\nparsedLines = lines.map(parseLine)\nprint(parsedLines.take(3))\n\nminTemps = parsedLines.filter(lambda x: \"TMIN\" in x[1])\nprint(minTemps.take(3))\n\nstationTemps = minTemps.map(lambda x: (x[0], x[2]))\nprint(stationTemps.take(3))\n\nminTemps = stationTemps.reduceByKey(lambda x, y: min(x,y))\nprint(minTemps.take(3))\n\n# spark => Python\nresults = minTemps.collect()\n\nfor ele in results:\n    print(ele)\n","dateUpdated":"Sep 7, 2018 3:01:58 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536288854091_1108964243","id":"20180907-025414_62616856","result":{"code":"SUCCESS","type":"TEXT","msg":"[u'ITE00100554,18000101,TMAX,-75,,,E,', u'ITE00100554,18000101,TMIN,-148,,,E,', u'GM000010962,18000101,PRCP,0,,,E,']\n[(u'ITE00100554', u'TMAX', 18.5), (u'ITE00100554', u'TMIN', 5.3599999999999994), (u'GM000010962', u'PRCP', 32.0)]\n[(u'ITE00100554', u'TMIN', 5.3599999999999994), (u'EZE00100082', u'TMIN', 7.6999999999999993), (u'ITE00100554', u'TMIN', 9.5)]\n[(u'ITE00100554', 5.3599999999999994), (u'EZE00100082', 7.6999999999999993), (u'ITE00100554', 9.5)]\n[(u'ITE00100554', 5.3599999999999994), (u'EZE00100082', 7.6999999999999993)]\n(u'ITE00100554', 5.3599999999999994)\n(u'EZE00100082', 7.6999999999999993)\n"},"dateCreated":"Sep 7, 2018 2:54:14 AM","dateStarted":"Sep 7, 2018 3:01:35 AM","dateFinished":"Sep 7, 2018 3:01:36 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4886"},{"text":"%md \n## Spark DataFrame\n- Spark DataFrame\n- Spark SQL","dateUpdated":"Sep 7, 2018 3:06:34 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","tableHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536289116930_-1036812666","id":"20180907-025836_2120554165","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>Spark DataFrame</h2>\n<ul>\n<li>Spark DataFrame</li>\n<li>Spark SQL</li>\n</ul>\n"},"dateCreated":"Sep 7, 2018 2:58:36 AM","dateStarted":"Sep 7, 2018 3:06:06 AM","dateFinished":"Sep 7, 2018 3:06:06 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4887"},{"text":"%sh \n\nexport http_proxy=http://10.160.3.88:8080\nexport https_proxy=http://10.160.3.88:8080\n\nrm u.data\nrm u.item\n\nwget https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/u.data\nwget https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/u.item\n\nhead u.data\nhead u.item\n","dateUpdated":"Sep 7, 2018 3:09:53 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536289544276_250553865","id":"20180907-030544_891170377","result":{"code":"SUCCESS","type":"TEXT","msg":"--2018-09-07 03:09:53--  https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/u.data\nConnecting to 10.160.3.88:8080... connected.\nProxy request sent, awaiting response... 200 OK\nLength: 1979173 (1.9M) [text/plain]\nSaving to: “u.data”\n\n     0K .......... .......... .......... .......... ..........  2%  639K 3s\n    50K .......... .......... .......... .......... ..........  5% 1.89M 2s\n   100K .......... .......... .......... .......... ..........  7% 1.85M 2s\n   150K .......... .......... .......... .......... .......... 10% 2.35M 1s\n   200K .......... .......... .......... .......... .......... 12% 1.70M 1s\n   250K .......... .......... .......... .......... .......... 15% 1.94M 1s\n   300K .......... .......... .......... .......... .......... 18% 1.97M 1s\n   350K .......... .......... .......... .......... .......... 20% 1.42M 1s\n   400K .......... .......... .......... .......... .......... 23% 1.72M 1s\n   450K .......... .......... .......... .......... .......... 25% 2.14M 1s\n   500K .......... .......... .......... .......... .......... 28% 1.89M 1s\n   550K .......... .......... .......... .......... .......... 31% 2.12M 1s\n   600K .......... .......... .......... .......... .......... 33% 1.84M 1s\n   650K .......... .......... .......... .......... .......... 36% 1.97M 1s\n   700K .......... .......... .......... .......... .......... 38% 1.64M 1s\n   750K .......... .......... .......... .......... .......... 41% 1.59M 1s\n   800K .......... .......... .......... .......... .......... 43% 1.90M 1s\n   850K .......... .......... .......... .......... .......... 46% 2.07M 1s\n   900K .......... .......... .......... .......... .......... 49% 1.75M 1s\n   950K .......... .......... .......... .......... .......... 51% 1.86M 1s\n  1000K .......... .......... .......... .......... .......... 54% 1.75M 1s\n  1050K .......... .......... .......... .......... .......... 56% 2.13M 0s\n  1100K .......... .......... .......... .......... .......... 59% 1.63M 0s\n  1150K .......... .......... .......... .......... .......... 62% 1.48M 0s\n  1200K .......... .......... .......... .......... .......... 64% 1.87M 0s\n  1250K .......... .......... .......... .......... .......... 67% 1.95M 0s\n  1300K .......... .......... .......... .......... .......... 69% 2.08M 0s\n  1350K .......... .......... .......... .......... .......... 72% 1.95M 0s\n  1400K .......... .......... .......... .......... .......... 75% 1.71M 0s\n  1450K .......... .......... .......... .......... .......... 77% 1.66M 0s\n  1500K .......... .......... .......... .......... .......... 80% 2.25M 0s\n  1550K .......... .......... .......... .......... .......... 82% 1.31M 0s\n  1600K .......... .......... .......... .......... .......... 85% 2.29M 0s\n  1650K .......... .......... .......... .......... .......... 87% 1.61M 0s\n  1700K .......... .......... .......... .......... .......... 90% 1.76M 0s\n  1750K .......... .......... .......... .......... .......... 93% 1.84M 0s\n  1800K .......... .......... .......... .......... .......... 95% 2.18M 0s\n  1850K .......... .......... .......... .......... .......... 98% 2.10M 0s\n  1900K .......... .......... .......... ..                   100% 1.76M=1.1s\n\n2018-09-07 03:09:55 (1.75 MB/s) - “u.data” saved [1979173/1979173]\n\n--2018-09-07 03:09:55--  https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/u.item\nConnecting to 10.160.3.88:8080... connected.\nProxy request sent, awaiting response... 200 OK\nLength: 236344 (231K) [text/plain]\nSaving to: “u.item”\n\n     0K .......... .......... .......... .......... .......... 21%  714K 0s\n    50K .......... .......... .......... .......... .......... 43% 1.67M 0s\n   100K .......... .......... .......... .......... .......... 64% 1.68M 0s\n   150K .......... .......... .......... .......... .......... 86% 1.74M 0s\n   200K .......... .......... ..........                      100% 2.67M=0.2s\n\n2018-09-07 03:09:55 (1.34 MB/s) - “u.item” saved [236344/236344]\n\n196\t242\t3\t881250949\n186\t302\t3\t891717742\n22\t377\t1\t878887116\n244\t51\t2\t880606923\n166\t346\t1\t886397596\n298\t474\t4\t884182806\n115\t265\t2\t881171488\n253\t465\t5\t891628467\n305\t451\t3\t886324817\n6\t86\t3\t883603013\n1|Toy Story (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Toy%20Story%20(1995)|0|0|0|1|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0\n2|GoldenEye (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?GoldenEye%20(1995)|0|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0\n3|Four Rooms (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Four%20Rooms%20(1995)|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0\n4|Get Shorty (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Get%20Shorty%20(1995)|0|1|0|0|0|1|0|0|1|0|0|0|0|0|0|0|0|0|0\n5|Copycat (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Copycat%20(1995)|0|0|0|0|0|0|1|0|1|0|0|0|0|0|0|0|1|0|0\n6|Shanghai Triad (Yao a yao yao dao waipo qiao) (1995)|01-Jan-1995||http://us.imdb.com/Title?Yao+a+yao+yao+dao+waipo+qiao+(1995)|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|0|0|0\n7|Twelve Monkeys (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Twelve%20Monkeys%20(1995)|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0|1|0|0|0\n8|Babe (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Babe%20(1995)|0|0|0|0|1|1|0|0|1|0|0|0|0|0|0|0|0|0|0\n9|Dead Man Walking (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Dead%20Man%20Walking%20(1995)|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|0|0|0\n10|Richard III (1995)|22-Jan-1996||http://us.imdb.com/M/title-exact?Richard%20III%20(1995)|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|0|1|0\n"},"dateCreated":"Sep 7, 2018 3:05:44 AM","dateStarted":"Sep 7, 2018 3:09:53 AM","dateFinished":"Sep 7, 2018 3:09:55 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4888"},{"text":"%sh \npwd","dateUpdated":"Sep 7, 2018 3:11:51 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536289900711_1890373043","id":"20180907-031140_296193191","result":{"code":"SUCCESS","type":"TEXT","msg":"/var/lib/zeppelin\n"},"dateCreated":"Sep 7, 2018 3:11:40 AM","dateStarted":"Sep 7, 2018 3:11:51 AM","dateFinished":"Sep 7, 2018 3:11:51 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4889"},{"text":"%pyspark \n\nratings = sc.textFile('file:///var/lib/zeppelin/u.data', 4)\nprint(ratings.take(3))\n\nratings_data = ratings.map(lambda l: l.split())\nprint(ratings_data.take(3))\n\n\nfrom pyspark.sql import Row\nratings_row_data = ratings_data.map(lambda p: Row(userid = p[0], movieid = p[1], rating = p[2]))\nprint(ratings_row_data.take(3))\n\nfrom pyspark.sql import SQLContext\nsqlContext = SQLContext(sc)\ndf = sqlContext.createDataFrame(ratings_row_data)\ndf.registerTempTable(\"ratings\")\n\n\ndf.show(5)","dateUpdated":"Sep 7, 2018 3:40:34 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536289622443_558676437","id":"20180907-030702_292935260","result":{"code":"SUCCESS","type":"TEXT","msg":"[u'196\\t242\\t3\\t881250949', u'186\\t302\\t3\\t891717742', u'22\\t377\\t1\\t878887116']\n[[u'196', u'242', u'3', u'881250949'], [u'186', u'302', u'3', u'891717742'], [u'22', u'377', u'1', u'878887116']]\n[Row(movieid=u'242', rating=u'3', userid=u'196'), Row(movieid=u'302', rating=u'3', userid=u'186'), Row(movieid=u'377', rating=u'1', userid=u'22')]\n+-------+------+------+\n|movieid|rating|userid|\n+-------+------+------+\n|    242|     3|   196|\n|    302|     3|   186|\n|    377|     1|    22|\n|     51|     2|   244|\n|    346|     1|   166|\n+-------+------+------+\nonly showing top 5 rows\n\n"},"dateCreated":"Sep 7, 2018 3:07:02 AM","dateStarted":"Sep 7, 2018 3:40:34 AM","dateFinished":"Sep 7, 2018 3:40:35 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4890"},{"text":"%pyspark\nmovies = sc.textFile('file:///var/lib/zeppelin/u.item', 4)\nprint(movies.take(3))\n\nmovies_data = movies.map(lambda l:l.split('|'))\nprint(movies_data.take(3))\n\nmovies_row_data= movies_data.map(lambda p:Row(movieid = p[0], moviename = p[1]))\nprint(movies_row_data.take(3))\n","dateUpdated":"Sep 7, 2018 3:19:07 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536289868092_1664864215","id":"20180907-031108_683295709","result":{"code":"SUCCESS","type":"TEXT","msg":"[u'1|Toy Story (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Toy%20Story%20(1995)|0|0|0|1|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0', u'2|GoldenEye (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?GoldenEye%20(1995)|0|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0', u'3|Four Rooms (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Four%20Rooms%20(1995)|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0']\n[[u'1', u'Toy Story (1995)', u'01-Jan-1995', u'', u'http://us.imdb.com/M/title-exact?Toy%20Story%20(1995)', u'0', u'0', u'0', u'1', u'1', u'1', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0'], [u'2', u'GoldenEye (1995)', u'01-Jan-1995', u'', u'http://us.imdb.com/M/title-exact?GoldenEye%20(1995)', u'0', u'1', u'1', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'1', u'0', u'0'], [u'3', u'Four Rooms (1995)', u'01-Jan-1995', u'', u'http://us.imdb.com/M/title-exact?Four%20Rooms%20(1995)', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'0', u'1', u'0', u'0']]\n[Row(movieid=u'1', moviename=u'Toy Story (1995)'), Row(movieid=u'2', moviename=u'GoldenEye (1995)'), Row(movieid=u'3', moviename=u'Four Rooms (1995)')]\n"},"dateCreated":"Sep 7, 2018 3:11:08 AM","dateStarted":"Sep 7, 2018 3:19:07 AM","dateFinished":"Sep 7, 2018 3:19:07 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4891"},{"text":"%pyspark\nrating_df = sqlContext.createDataFrame(ratings_row_data)\nrating_df.registerTempTable('ratings')\nrating_df.show(5)\n","dateUpdated":"Sep 7, 2018 3:20:12 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536290227581_-1750679298","id":"20180907-031707_184727279","result":{"code":"SUCCESS","type":"TEXT","msg":"+-------+------+------+\n|movieid|rating|userid|\n+-------+------+------+\n|    242|     3|   196|\n|    302|     3|   186|\n|    377|     1|    22|\n|     51|     2|   244|\n|    346|     1|   166|\n+-------+------+------+\nonly showing top 5 rows\n\n"},"dateCreated":"Sep 7, 2018 3:17:07 AM","dateStarted":"Sep 7, 2018 3:20:12 AM","dateFinished":"Sep 7, 2018 3:20:13 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4892"},{"text":"%pyspark\nmovie_df = sqlContext.createDataFrame(movies_row_data)\nmovie_df.registerTempTable('movies')\nmovie_df.show(5)","dateUpdated":"Sep 7, 2018 3:20:42 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536290406192_-353193027","id":"20180907-032006_882967794","result":{"code":"SUCCESS","type":"TEXT","msg":"+-------+-----------------+\n|movieid|        moviename|\n+-------+-----------------+\n|      1| Toy Story (1995)|\n|      2| GoldenEye (1995)|\n|      3|Four Rooms (1995)|\n|      4|Get Shorty (1995)|\n|      5|   Copycat (1995)|\n+-------+-----------------+\nonly showing top 5 rows\n\n"},"dateCreated":"Sep 7, 2018 3:20:06 AM","dateStarted":"Sep 7, 2018 3:20:42 AM","dateFinished":"Sep 7, 2018 3:20:42 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4893"},{"text":"%pyspark\n#best_movies = sqlContext.sql(\"select movieid, count(1) from ratings group by movieid\")\n#best_movies = sqlContext.sql(\"select movieid, count(1) from ratings group by movieid order by count(1) desc limit 30\")\n\nbest_movies = sqlContext.sql(\"select moviename, count(1) as cnt from ratings inner join movies on ratings.movieid = movies.movieid group by moviename order by count(1) desc limit 30\")\nbest_movies.show(5)","dateUpdated":"Sep 7, 2018 3:24:22 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536290442430_-364674198","id":"20180907-032042_1542640960","result":{"code":"SUCCESS","type":"TEXT","msg":"+--------------------+---+\n|           moviename|cnt|\n+--------------------+---+\n|    Star Wars (1977)|583|\n|      Contact (1997)|509|\n|        Fargo (1996)|508|\n|Return of the Jed...|507|\n|    Liar Liar (1997)|485|\n+--------------------+---+\nonly showing top 5 rows\n\n"},"dateCreated":"Sep 7, 2018 3:20:42 AM","dateStarted":"Sep 7, 2018 3:24:22 AM","dateFinished":"Sep 7, 2018 3:24:34 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4894"},{"text":"%pyspark\n\n\nbest_movies = sqlContext.sql(\"select moviename, avg(ratings.rating) as mean_rating, count(1) as cnt from ratings inner join movies on ratings.movieid = movies.movieid group by moviename  order by  avg(ratings.rating) desc limit 30\")\nbest_movies.show(30)","dateUpdated":"Sep 7, 2018 3:32:39 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536290726228_-907962070","id":"20180907-032526_688276162","result":{"code":"SUCCESS","type":"TEXT","msg":"+--------------------+------------------+---+\n|           moviename|       mean_rating|cnt|\n+--------------------+------------------+---+\n|Great Day in Harl...|               5.0|  1|\n|Entertaining Ange...|               5.0|  1|\n|They Made Me a Cr...|               5.0|  1|\n|Aiqing wansui (1994)|               5.0|  1|\n|     Star Kid (1997)|               5.0|  3|\n|Saint of Fort Was...|               5.0|  2|\n|  Prefontaine (1997)|               5.0|  3|\n|Marlene Dietrich:...|               5.0|  1|\n|Santa with Muscle...|               5.0|  2|\n|Someone Else's Am...|               5.0|  1|\n|Pather Panchali (...|             4.625|  8|\n|Maya Lin: A Stron...|               4.5|  4|\n|         Anna (1996)|               4.5|  2|\n|      Everest (1998)|               4.5|  2|\n|Some Mother's Son...|               4.5|  2|\n|Close Shave, A (1...| 4.491071428571429|112|\n|Schindler's List ...| 4.466442953020135|298|\n|Wrong Trousers, T...| 4.466101694915254|118|\n|   Casablanca (1942)|  4.45679012345679|243|\n|Wallace & Gromit:...| 4.447761194029851| 67|\n|Shawshank Redempt...| 4.445229681978798|283|\n|  Rear Window (1954)|4.3875598086124405|209|\n|Usual Suspects, T...| 4.385767790262173|267|\n|    Star Wars (1977)|4.3584905660377355|583|\n| 12 Angry Men (1957)|             4.344|125|\n|Third Man, The (1...| 4.333333333333333| 72|\n|Bitter Sugar (Azu...| 4.333333333333333|  3|\n|Letter From Death...| 4.333333333333333|  3|\n| Citizen Kane (1941)| 4.292929292929293|198|\n|Some Folks Call I...|4.2926829268292686| 41|\n+--------------------+------------------+---+\n\n"},"dateCreated":"Sep 7, 2018 3:25:26 AM","dateStarted":"Sep 7, 2018 3:32:39 AM","dateFinished":"Sep 7, 2018 3:32:50 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4895"},{"text":"%md \n## MLLib","dateUpdated":"Sep 7, 2018 6:11:41 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536297228299_-1711030501","id":"20180907-051348_80707570","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>MLLib</h2>\n"},"dateCreated":"Sep 7, 2018 5:13:48 AM","dateStarted":"Sep 7, 2018 6:11:41 AM","dateFinished":"Sep 7, 2018 6:11:41 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4896"},{"text":"%sh \n\nexport http_proxy=http://10.160.3.88:8080\nexport https_proxy=http://10.160.3.88:8080\n\nwget https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/churnTrain.csv","dateUpdated":"Sep 7, 2018 6:12:43 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536300694833_97777462","id":"20180907-061134_359853771","result":{"code":"SUCCESS","type":"TEXT","msg":"--2018-09-07 06:12:43--  https://raw.githubusercontent.com/ywchiu/chtspark/master/Spark/churnTrain.csv\nConnecting to 10.160.3.88:8080... connected.\nProxy request sent, awaiting response... 200 OK\nLength: 356734 (348K) [text/plain]\nSaving to: “churnTrain.csv”\n\n     0K .......... .......... .......... .......... .......... 14%  630K 0s\n    50K .......... .......... .......... .......... .......... 28% 1.52M 0s\n   100K .......... .......... .......... .......... .......... 43% 1.36M 0s\n   150K .......... .......... .......... .......... .......... 57% 2.47M 0s\n   200K .......... .......... .......... .......... .......... 71% 1.52M 0s\n   250K .......... .......... .......... .......... .......... 86% 1.09M 0s\n   300K .......... .......... .......... .......... ........  100% 1.21M=0.3s\n\n2018-09-07 06:12:44 (1.20 MB/s) - “churnTrain.csv” saved [356734/356734]\n\n"},"dateCreated":"Sep 7, 2018 6:11:34 AM","dateStarted":"Sep 7, 2018 6:12:43 AM","dateFinished":"Sep 7, 2018 6:12:44 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4897"},{"text":"%sh \nhead churnTrain.csv","dateUpdated":"Sep 7, 2018 6:12:57 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536300763279_-542906078","id":"20180907-061243_784104213","result":{"code":"SUCCESS","type":"TEXT","msg":"\"\",\"state\",\"account_length\",\"area_code\",\"international_plan\",\"voice_mail_plan\",\"number_vmail_messages\",\"total_day_minutes\",\"total_day_calls\",\"total_day_charge\",\"total_eve_minutes\",\"total_eve_calls\",\"total_eve_charge\",\"total_night_minutes\",\"total_night_calls\",\"total_night_charge\",\"total_intl_minutes\",\"total_intl_calls\",\"total_intl_charge\",\"number_customer_service_calls\",\"churn\"\n\"1\",\"KS\",128,\"area_code_415\",\"no\",\"yes\",25,265.1,110,45.07,197.4,99,16.78,244.7,91,11.01,10,3,2.7,1,\"no\"\n\"2\",\"OH\",107,\"area_code_415\",\"no\",\"yes\",26,161.6,123,27.47,195.5,103,16.62,254.4,103,11.45,13.7,3,3.7,1,\"no\"\n\"3\",\"NJ\",137,\"area_code_415\",\"no\",\"no\",0,243.4,114,41.38,121.2,110,10.3,162.6,104,7.32,12.2,5,3.29,0,\"no\"\n\"4\",\"OH\",84,\"area_code_408\",\"yes\",\"no\",0,299.4,71,50.9,61.9,88,5.26,196.9,89,8.86,6.6,7,1.78,2,\"no\"\n\"5\",\"OK\",75,\"area_code_415\",\"yes\",\"no\",0,166.7,113,28.34,148.3,122,12.61,186.9,121,8.41,10.1,3,2.73,3,\"no\"\n\"6\",\"AL\",118,\"area_code_510\",\"yes\",\"no\",0,223.4,98,37.98,220.6,101,18.75,203.9,118,9.18,6.3,6,1.7,0,\"no\"\n\"7\",\"MA\",121,\"area_code_510\",\"no\",\"yes\",24,218.2,88,37.09,348.5,108,29.62,212.6,118,9.57,7.5,7,2.03,3,\"no\"\n\"8\",\"MO\",147,\"area_code_415\",\"yes\",\"no\",0,157,79,26.69,103.1,94,8.76,211.8,96,9.53,7.1,6,1.92,0,\"no\"\n\"9\",\"LA\",117,\"area_code_408\",\"no\",\"no\",0,184.5,97,31.37,351.6,80,29.89,215.8,90,9.71,8.7,4,2.35,1,\"no\"\n"},"dateCreated":"Sep 7, 2018 6:12:43 AM","dateStarted":"Sep 7, 2018 6:12:57 AM","dateFinished":"Sep 7, 2018 6:12:58 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4898"},{"text":"%sh \npwd","dateUpdated":"Sep 7, 2018 6:15:03 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536300893291_1375668121","id":"20180907-061453_1756221032","result":{"code":"SUCCESS","type":"TEXT","msg":"/var/lib/zeppelin\n"},"dateCreated":"Sep 7, 2018 6:14:53 AM","dateStarted":"Sep 7, 2018 6:15:03 AM","dateFinished":"Sep 7, 2018 6:15:03 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4899"},{"text":"%pyspark \n\nraw_data = sc.textFile(\"file:///var/lib/zeppelin/churnTrain.csv\")\n#print(raw_data.take(3))\n\nheader = raw_data.first()\n\nskip_data = raw_data.filter(lambda line: line != header)\nprint(skip_data.take(3))\n","dateUpdated":"Sep 7, 2018 6:40:24 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536300777946_1037288303","id":"20180907-061257_1144222857","result":{"code":"SUCCESS","type":"TEXT","msg":"[u'\"1\",\"KS\",128,\"area_code_415\",\"no\",\"yes\",25,265.1,110,45.07,197.4,99,16.78,244.7,91,11.01,10,3,2.7,1,\"no\"', u'\"2\",\"OH\",107,\"area_code_415\",\"no\",\"yes\",26,161.6,123,27.47,195.5,103,16.62,254.4,103,11.45,13.7,3,3.7,1,\"no\"', u'\"3\",\"NJ\",137,\"area_code_415\",\"no\",\"no\",0,243.4,114,41.38,121.2,110,10.3,162.6,104,7.32,12.2,5,3.29,0,\"no\"']\n"},"dateCreated":"Sep 7, 2018 6:12:57 AM","dateStarted":"Sep 7, 2018 6:40:24 AM","dateFinished":"Sep 7, 2018 6:40:27 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4900","focus":true},{"text":"%pyspark \n\n\n\n    \n\nsplitlines   = skip_data.map(lambda l: l.split(','))\nprint(splitlines.take(3))\n\nfrom pyspark.mllib.regression import LabeledPoint\nfrom pyspark.mllib.linalg import Vectors\n\ndef parseLine(col):\n    features = []\n    churn = col[-1]\n    international = 0 if col[4] == '\"no\"' else 1\n    voice = 0 if col[5] == '\"no\"'  else 1\n    label = 0 if churn == '\"no\"' else 1\n    features.append(international)\n    features.append(voice)\n    features += col[6:-1]\n    return LabeledPoint(label, Vectors.dense(features))\n\ntrainData = splitlines.map(parseLine)\nprint(trainData.take(2))\n\n\nfrom pyspark.mllib.tree import DecisionTree\nmodel = DecisionTree.trainClassifier(trainData, numClasses=2, categoricalFeaturesInfo={},\n                                     impurity='gini', maxDepth=5)\n                                     \n                                     \nprint(model)\n\n\n\nhead  = trainData.first()\nprint(model.predict(head.features))\n","dateUpdated":"Sep 7, 2018 6:44:05 AM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536300920377_1130998469","id":"20180907-061520_1548813346","result":{"code":"SUCCESS","type":"TEXT","msg":"[[u'\"1\"', u'\"KS\"', u'128', u'\"area_code_415\"', u'\"no\"', u'\"yes\"', u'25', u'265.1', u'110', u'45.07', u'197.4', u'99', u'16.78', u'244.7', u'91', u'11.01', u'10', u'3', u'2.7', u'1', u'\"no\"'], [u'\"2\"', u'\"OH\"', u'107', u'\"area_code_415\"', u'\"no\"', u'\"yes\"', u'26', u'161.6', u'123', u'27.47', u'195.5', u'103', u'16.62', u'254.4', u'103', u'11.45', u'13.7', u'3', u'3.7', u'1', u'\"no\"'], [u'\"3\"', u'\"NJ\"', u'137', u'\"area_code_415\"', u'\"no\"', u'\"no\"', u'0', u'243.4', u'114', u'41.38', u'121.2', u'110', u'10.3', u'162.6', u'104', u'7.32', u'12.2', u'5', u'3.29', u'0', u'\"no\"']]\n[LabeledPoint(0.0, [0.0,1.0,25.0,265.1,110.0,45.07,197.4,99.0,16.78,244.7,91.0,11.01,10.0,3.0,2.7,1.0]), LabeledPoint(0.0, [0.0,1.0,26.0,161.6,123.0,27.47,195.5,103.0,16.62,254.4,103.0,11.45,13.7,3.0,3.7,1.0])]\nDecisionTreeModel classifier of depth 5 with 57 nodes\n0.0\n"},"dateCreated":"Sep 7, 2018 6:15:20 AM","dateStarted":"Sep 7, 2018 6:44:05 AM","dateFinished":"Sep 7, 2018 6:44:07 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4901","focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536302567264_-1927659529","id":"20180907-064247_1824959611","dateCreated":"Sep 7, 2018 6:42:47 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5337","dateUpdated":"Sep 7, 2018 6:49:29 AM","dateFinished":"Sep 7, 2018 6:49:33 AM","dateStarted":"Sep 7, 2018 6:49:29 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]\n[(0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0), (0.0, 0.0)]\n0.949294929493\nArea under ROC = 0.933551517636\n"},"text":"%pyspark\n\npredictions= model.predict(trainData.map(lambda p: p.features))\nprint(predictions.take(10))\n\n\nlabels_and_preds = trainData.map(lambda p: p.label).zip(predictions)\nprint(labels_and_preds.take(10))\n\n\ntest_accuracy = labels_and_preds.filter(lambda (v, p): v == p).count() / float(trainData.count())\nprint(test_accuracy)\n\n\nfrom pyspark.mllib.evaluation import BinaryClassificationMetrics\nmetrics = BinaryClassificationMetrics(labels_and_preds)\nprint(\"Area under ROC = %s\" % metrics.areaUnderROC)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1536302959211_-525065898","id":"20180907-064919_1263746450","dateCreated":"Sep 7, 2018 6:49:19 AM","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5405"}],"name":"Demo20180907","id":"2DRZKZ26G","angularObjects":{"2DQS381XG":[],"2DP1NQB2Y":[],"2DS32RBA5":[],"2DPBHDJ9T":[],"2DPJ9SSE8":[],"2DSMNSEZQ":[],"2DP8EB2NX":[],"2DRSASV7F":[],"2DS7USPWU":[],"2DPCKDNAK":[],"2DS8ESHK4":[],"2DQWU4XT8":[],"2DS15K3WA":[]},"config":{"looknfeel":"default"},"info":{}}