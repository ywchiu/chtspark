{"paragraphs":[{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467617546601_1049660214","id":"20160704-073226_226982086","dateCreated":"Jul 4, 2016 7:32:26 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3248","text":"%pyspark\n\ndata_file = \"/tmp/ratings.txt\"\nraw_data = sc.textFile(data_file)\nprint raw_data.take(3)\n\nheader = raw_data.first()\nskip_data = raw_data.filter(lambda line: line != header)\n\ncsv_data = skip_data.map(lambda l: l.split(\"::\"))\nrow_data = csv_data.map(lambda p: Row(\n    userid=p[0], \n    itemid=p[1],\n    rating=int(p[2])\n    )\n)\n\nprint row_data.take(3)","dateUpdated":"Jul 4, 2016 7:34:17 AM","dateFinished":"Jul 4, 2016 7:34:17 AM","dateStarted":"Jul 4, 2016 7:34:17 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[u'userid::itemid::rating', u'0::0::4', u'0::1::5']\n[Row(itemid=u'0', rating=4, userid=u'0'), Row(itemid=u'1', rating=5, userid=u'0'), Row(itemid=u'7495', rating=3, userid=u'0')]\n"},"focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467617684504_-9771336","id":"20160704-073444_1436635336","dateCreated":"Jul 4, 2016 7:34:44 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3292","text":"%pyspark\n\ndf = sqlContext.createDataFrame(row_data)\ndf.printSchema()\ndf.registerTempTable(\"ratings\")","dateUpdated":"Jul 4, 2016 8:02:01 AM","dateFinished":"Jul 4, 2016 8:02:01 AM","dateStarted":"Jul 4, 2016 8:02:01 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"root\n |-- itemid: string (nullable = true)\n |-- rating: long (nullable = true)\n |-- userid: string (nullable = true)\n\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467617703142_-1222099796","id":"20160704-073503_1590840510","dateCreated":"Jul 4, 2016 7:35:03 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3312","dateUpdated":"Jul 4, 2016 7:47:55 AM","dateFinished":"Jul 4, 2016 7:47:55 AM","dateStarted":"Jul 4, 2016 7:47:55 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[Row(itemid=u'0', rating=4, userid=u'0'), Row(itemid=u'1', rating=5, userid=u'0'), Row(itemid=u'7495', rating=3, userid=u'0')]\n+------+------+------+\n|itemid|rating|userid|\n+------+------+------+\n|     0|     4|     0|\n|     1|     5|     0|\n|  7495|     3|     0|\n+------+------+------+\nonly showing top 3 rows\n\nNone\n['__class__', '__delattr__', '__dict__', '__doc__', '__format__', '__getattr__', '__getattribute__', '__getitem__', '__hash__', '__init__', '__module__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', '_jcols', '_jdf', '_jmap', '_jseq', '_lazy_rdd', '_sc', '_schema', '_sort_cols', 'agg', 'alias', 'cache', 'coalesce', 'collect', 'columns', 'corr', 'count', 'cov', 'crosstab', 'cube', 'describe', 'distinct', 'drop', 'dropDuplicates', 'drop_duplicates', 'dropna', 'dtypes', 'explain', 'fillna', 'filter', 'first', 'flatMap', 'foreach', 'foreachPartition', 'freqItems', 'groupBy', 'groupby', 'head', 'insertInto', 'intersect', 'isLocal', 'is_cached', 'join', 'limit', 'map', 'mapPartitions', 'na', 'orderBy', 'persist', 'printSchema', 'randomSplit', 'rdd', 'registerAsTable', 'registerTempTable', 'repartition', 'replace', 'rollup', 'sample', 'sampleBy', 'save', 'saveAsParquetFile', 'saveAsTable', 'schema', 'select', 'selectExpr', 'show', 'sort', 'sortWithinPartitions', 'sql_ctx', 'stat', 'subtract', 'take', 'toDF', 'toJSON', 'toPandas', 'unionAll', 'unpersist', 'where', 'withColumn', 'withColumnRenamed', 'write']\n"},"text":"%pyspark\n\nprint df.take(3)\nprint df.show(3)\nprint dir(df)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"userid","index":0,"aggr":"sum"}],"values":[{"name":"_c1","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"userid","index":0,"aggr":"sum"},"yAxis":{"name":"_c1","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467617770669_-968642216","id":"20160704-073610_2015818603","dateCreated":"Jul 4, 2016 7:36:10 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3359","dateUpdated":"Jul 4, 2016 8:04:55 AM","dateFinished":"Jul 4, 2016 8:05:06 AM","dateStarted":"Jul 4, 2016 8:04:55 AM","result":{"code":"SUCCESS","type":"TABLE","msg":"userid\t_c1\n6048\t5.0\n6994\t5.0\n6381\t5.0\n","comment":"","msgTable":[[{"key":"_c1","value":"6048"},{"key":"_c1","value":"5.0"}],[{"value":"6994"},{"value":"5.0"}],[{"value":"6381"},{"value":"5.0"}]],"columnNames":[{"name":"userid","index":0,"aggr":"sum"},{"name":"_c1","index":1,"aggr":"sum"}],"rows":[["6048","5.0"],["6994","5.0"],["6381","5.0"]]},"text":"%sql \r\n\r\nSELECT userid,avg(rating) from ratings group by userid order by avg(rating) desc limit 3\r\n\r\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467619598387_-323967812","id":"20160704-080638_1941006206","dateCreated":"Jul 4, 2016 8:06:38 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3478","text":"%pyspark\n\n\ndf.select(\"userid\", \"rating\").groupBy(\"userid\").avg().show()\n","dateUpdated":"Jul 4, 2016 8:06:55 AM","dateFinished":"Jul 4, 2016 8:07:04 AM","dateStarted":"Jul 4, 2016 8:06:55 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"+------+------------------+\n|userid|       avg(rating)|\n+------+------------------+\n|   286| 3.741496598639456|\n|   330|3.4833333333333334|\n|   448|3.7277486910994764|\n|   781|            3.6125|\n|   899| 4.141414141414141|\n|   943|3.4838709677419355|\n|  1098|               3.4|\n|  1142|4.4772727272727275|\n|  1304|              3.92|\n|  1593|3.2674418604651163|\n|  1755| 3.466666666666667|\n|  1917|3.8333333333333335|\n|  2033|              4.25|\n|  2484|             3.125|\n|  2646|              2.75|\n|  2808|              4.25|\n|  3375|               4.1|\n|  3537|               3.5|\n|  3870| 4.230769230769231|\n|  3988|               4.0|\n+------+------------------+\nonly showing top 20 rows\n\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467620156165_-1106734254","id":"20160704-081556_982656238","dateCreated":"Jul 4, 2016 8:15:56 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3524","dateUpdated":"Jul 4, 2016 8:17:33 AM","dateFinished":"Jul 4, 2016 8:16:37 AM","dateStarted":"Jul 4, 2016 8:16:36 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[('a', (1, 2)), ('a', (1, 3))]\n"},"text":"%pyspark\n\nx = sc.parallelize([(\"a\", 1), (\"b\", 4)]) \ny = sc.parallelize([(\"a\", 2), (\"a\", 3)]) \nprint sorted(x.join(y).collect()) "},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467620221118_-1521970263","id":"20160704-081701_877068435","dateCreated":"Jul 4, 2016 8:17:01 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3571","text":"%pyspark\n\nx = sc.parallelize([(\"a\", 1), (\"b\", 4)]) \ny = sc.parallelize([(\"a\", 2)]) \nprint sorted(x.leftOuterJoin(y).collect()) ","dateUpdated":"Jul 4, 2016 8:18:04 AM","dateFinished":"Jul 4, 2016 8:17:24 AM","dateStarted":"Jul 4, 2016 8:17:23 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[('a', (1, 2)), ('b', (4, None))]\n"}},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467620238293_655354411","id":"20160704-081718_1488143273","dateCreated":"Jul 4, 2016 8:17:18 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3597","dateUpdated":"Jul 4, 2016 8:18:27 AM","dateFinished":"Jul 4, 2016 8:17:55 AM","dateStarted":"Jul 4, 2016 8:17:54 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[('a', (2, 1)), ('b', (None, 4))]\n"},"text":"%pyspark\n\nx = sc.parallelize([(\"a\", 1), (\"b\", 4)]) \ny = sc.parallelize([(\"a\", 2)]) \nprint sorted(y.rightOuterJoin(x).collect())"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467620269912_743644155","id":"20160704-081749_555429142","dateCreated":"Jul 4, 2016 8:17:49 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3623","dateUpdated":"Jul 4, 2016 8:18:17 AM","dateFinished":"Jul 4, 2016 8:18:18 AM","dateStarted":"Jul 4, 2016 8:18:17 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"[('a', (1, 2)), ('b', (4, None)), ('c', (None, 8))]\n"},"text":"%pyspark\nx = sc.parallelize([(\"a\", 1), (\"b\", 4)]) \ny = sc.parallelize([(\"a\", 2), (\"c\", 8)]) \nprint sorted(x.fullOuterJoin(y).collect()) "},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467620292499_-832641440","id":"20160704-081812_1238653942","dateCreated":"Jul 4, 2016 8:18:12 AM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3649","dateUpdated":"Jul 4, 2016 8:56:41 AM","dateFinished":"Jul 4, 2016 8:56:41 AM","dateStarted":"Jul 4, 2016 8:56:41 AM","result":{"code":"SUCCESS","type":"TEXT","msg":"\"\",\"state\",\"account_length\",\"area_code\",\"international_plan\",\"voice_mail_plan\",\"number_vmail_messages\",\"total_day_minutes\",\"total_day_calls\",\"total_day_charge\",\"total_eve_minutes\",\"total_eve_calls\",\"total_eve_charge\",\"total_night_minutes\",\"total_night_calls\",\"total_night_charge\",\"total_intl_minutes\",\"total_intl_calls\",\"total_intl_charge\",\"number_customer_service_calls\",\"churn\"\n[u'\"1\",\"KS\",128,\"area_code_415\",\"no\",\"yes\",25,265.1,110,45.07,197.4,99,16.78,244.7,91,11.01,10,3,2.7,1,\"no\"', u'\"2\",\"OH\",107,\"area_code_415\",\"no\",\"yes\",26,161.6,123,27.47,195.5,103,16.62,254.4,103,11.45,13.7,3,3.7,1,\"no\"', u'\"3\",\"NJ\",137,\"area_code_415\",\"no\",\"no\",0,243.4,114,41.38,121.2,110,10.3,162.6,104,7.32,12.2,5,3.29,0,\"no\"']\n"},"text":"%pyspark \n\nraw_data = sc.textFile(\"/tmp/churnTrain.csv\")\nheader = raw_data.first()\nprint header\nskip_data = raw_data.filter(lambda line: line != header)\nprint skip_data.take(3)"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467622626551_-1469367759","id":"20160704-085706_564139321","dateCreated":"Jul 4, 2016 8:57:06 AM","status":"ERROR","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3729","dateUpdated":"Jul 4, 2016 9:03:50 AM","dateFinished":"Jul 4, 2016 9:03:24 AM","dateStarted":"Jul 4, 2016 9:03:24 AM","result":{"code":"ERROR","type":"TEXT","msg":"2029\n1304\n[[u'\"1\"', u'\"KS\"', u'128', u'\"area_code_415\"', u'\"no\"', u'\"yes\"', u'25', u'265.1', u'110', u'45.07', u'197.4', u'99', u'16.78', u'244.7', u'91', u'11.01', u'10', u'3', u'2.7', u'1', u'\"no\"']]\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark.py\", line 222, in <module>\n    eval(compiledCode)\n  File \"<string>\", line 8, in <module>\n  File \"/usr/hdp/current/spark-client/python/pyspark/mllib/__init__.py\", line 25, in <module>\n    import numpy\n  File \"/usr/lib64/python2.6/site-packages/numpy/__init__.py\", line 180, in <module>\n    from . import add_newdocs\n  File \"/usr/lib64/python2.6/site-packages/numpy/add_newdocs.py\", line 13, in <module>\n    from numpy.lib import add_newdoc\n  File \"/usr/lib64/python2.6/site-packages/numpy/lib/__init__.py\", line 8, in <module>\n    from .type_check import *\n  File \"/usr/lib64/python2.6/site-packages/numpy/lib/type_check.py\", line 11, in <module>\n    import numpy.core.numeric as _nx\n  File \"/usr/lib64/python2.6/site-packages/numpy/core/__init__.py\", line 14, in <module>\n    from . import multiarray\nImportError: cannot import name multiarray\n"},"text":"%pyspark \nsplitData = skip_data.randomSplit([0.6,0.4],123)\na = splitData[0]\nprint a.count()\nb = splitData[1]\nprint b.count()\n\nsplitlines = skip_data.map(lambda l: l.split(\",\"))\nprint splitlines.take(1)\n\n\nfrom pyspark.mllib.regression import LabeledPoint\nfrom pyspark.mllib.linalg import Vectors\n\n\ndef parseLine(col):\n    features = []\n    churn = col[-1]\n    international = 0 if col[4] == '\"no\"' else 1\n    voice = 0 if col[5] == '\"no\"'  else 1\n    label = 0 if churn == '\"no\"' else 1\n    features.append(international)\n    features.append(voice)\n    features += col[6:-1]\n    return LabeledPoint(label, Vectors.dense(features))\n\ntrainData = splitlines.map(parseLine)\ntrainData.take(2)\n\n\nfrom pyspark.mllib.tree import DecisionTree\nmodel = DecisionTree.trainClassifier(trainData, numClasses=2, categoricalFeaturesInfo={},\n                                     impurity='gini', maxDepth=5)\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1467622637527_375518541","id":"20160704-085717_811225132","dateCreated":"Jul 4, 2016 8:57:17 AM","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3749","dateUpdated":"Jul 4, 2016 8:57:57 AM","text":"splitlines = skip_data.map(lambda l: l.split(\",\"))\nsplitlines.take(1)"}],"name":"Spark SQL","id":"2BRYS6W7F","angularObjects":{"2BNTPQYNU":[],"2BPRP26MG":[],"2BPDHNPRP":[],"2BMBNFGZF":[],"2BMP8WG3B":[],"2BQSBGEHB":[],"2BPQ5B7A7":[],"2BNBV1BFX":[],"2BP3876PR":[],"2BN6E79V9":[],"2BQ34585C":[],"2BQ6FQ43H":[],"2BMZATA98":[]},"config":{"looknfeel":"default"},"info":{}}